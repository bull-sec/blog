# SSH - Port 22

Secure Shell. SSH is the most reliable protocol in terms of gaining a connection to a remote machine. It creates a secure TCP tunnel to the target and spawns a proper TTY for us to run commands in. 

If we can gain SSH access we have gotten a *significant* foothold on the target.

## Fingerprinting

`nmap` does a pretty good job of grabbing the running version. But in the cases that it doesn't:

```bash
»»» nc -vn 10.10.10.77 22
(UNKNOWN) [10.10.10.77] 22 (ssh) open
SSH-2.0-OpenSSH_7.6
```

By default `nmap` will grab the Public Key of any SSH service it encounters, but if we're not using `nmap` for some reason:

```bash
ssh-keyscan -t rsa 10.10.10.10 -p 22
```

## Connecting

On Linux it's super simple:

```bash
ssh user@10.10.10.10
ssh user@domain.com
```

With a Private Key:

```bash
chmod 400 /path/to/key
ssh -i /path/to/key user@10.10.10.10
```

### PuTTY

PuTTY is the way we would connect to an SSH server before the advent of SSH for Windows and WSL. But it's worth going over as we do occasionally find the connection files lying around, and the application itself leaves some fingerprints and data laying around we can use to our advantage.

## Bruteforcing

Be careful with Bruteforcing as we can run into either IP lockouts, or timeouts that just cause things to take too long to run:

[Default Credentials](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/top-20-common-SSH-passwords.txt)

[More Default Credentials](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt)

[Check for Acceptance of Captured/Held Keys](https://nmap.org/nsedoc/scripts/ssh-publickey-acceptance.html)



## Bad Cipher Suites

We sometimes run into older machines running out of date ciphers, this can be a pain but it's easy to get around if you know what to do.

When you connect to one of these older machines you'll get an error message saying something like "Mismatched Cipher" and it'll also suggest a list of cipher suites that you both have in common that you can communicate with. 

Try these one at a time with the following command:

```bash
ssh -okexAlgorithms=+<algorithm_name> <username>@host
```


## Known Exploits

One "exploit" that comes up all the time during testing is a known issue with user enumeration. 

[CVE-2018-15473](https://www.exploit-db.com/exploits/45233)

It's not considered an exploit by the developers and as such is present in a bunch of more recent versions.


