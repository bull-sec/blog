# DNS - Port 53

Domain Name Service.

This is the protocol that allows for google.com to be a thing. Basically it takes an ip and converts it to a domain name by doing a look up against a big list. So in the case of google.com, when Google register that domain a new entry gets added to the list that has the domain (google.com) as well as a list of IP addresses associated with the domain.

When we make a request to google.com our request first goes to the nearest DNS server* which goes into it's list and checks for the domain and it's associated IP's, if it can't find it the request is sent to the next nearest DNS server and then the next, until we eventually get a response back from the domain.

\* There is a typical order for DNS requests

- localhost
- any configured local DNS
- router
- 3rd party DNS resolver

## Basic Recon

```bash
dnsrecon -n 8.8.8.8 -d ctfchallengedojo.co.uk
```

> The above command is essentially the same output as [DNSDumpster](https://dnsdumpster.com)

```bash
sublist3r -d ctfchallengedojo.co.uk
```

> The above is fairly reliable except the one in Kali is broken af :( use the fresh one from the git repo and it works fine

## Bruteforcing Subdomains

```bash
dnsrecon -d ctfchallengedojo.co.uk -D /root/wordlists/namelist.txt -t brt
```

> Note that the above command requires an absolute path, it doesn't know how to deal with .'s and ~'s. Also it takes an age to run...


## Empty Requests

This is an odd one but it does sometimes work. 

If we send a raw request without any additional headers we can sometimes get the hostname back when it reports the 400 (Bad Request) back to us:

```
GET / HTTP/1.1
```

This will fail to actually find anything, but we'll occasionally get something back like the following:

```
nc 10.10.10.29 80
GET / HTTP/1.1
HTTP/1.1 400 Bad Request
Date: Sat, 25 Apr 2020 10:32:10 GMT
Server: Apache/2.4.7 (Ubuntu)
Content-Length: 300
Connection: close
Content-Type: text/html; charset=iso-8859-1

<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>400 Bad Request</title>
</head><body>
<h1>Bad Request</h1>
<p>Your browser sent a request that this server could not understand.<br />
</p>
<hr>
<address>Apache/2.4.7 (Ubuntu) Server at 127.0.1.1 Port 80</address>
</body></html>
```

Sometimes the `address` line will have the actual hostname instead of the internal IP as shown above. 


## A Note on Bug Bounties

DNS is a *MAJOR* part of bug bounties as it allows you to enumerate the hostnames of your bounty targets. The main aim is to gather as much information as possible, and we could be here for a *LONG* time 

## Enumeration

We can't really do a "Banner Grab" like we would with a normal service, the closest we can get is the following command that should return the version of the DNS server that's running:

```bash
dig version.bind CHAOS TXT @DNS
```

(Look in the "Answer" section)

We can also add `--script dns-nsid` onto our initial `nmap` scan to return the same information. 

### Zone Transfers

```bash
dig axfr @<DNS_IP> #Try zone transfer without domain
dig axfr @<DNS_IP> <DOMAIN> #Try zone transfer guessing the domain
fierce -dns <DOMAIN> #Will try to perform a zone transfer against every authoritative name server and if this doesn't work, will launch a dictionary attack
```

